/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/sse.js@2.5.0/lib/sse.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var SSE=function(t,s){if(!(this instanceof SSE))return new SSE(t,s);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=t,s=s||{},this.headers=s.headers||{},this.payload=void 0!==s.payload?s.payload:"",this.method=s.method||(this.payload?"POST":"GET"),this.withCredentials=!!s.withCredentials,this.debug=!!s.debug,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.lastEventId="",this.addEventListener=function(t,s){void 0===this.listeners[t]&&(this.listeners[t]=[]),-1===this.listeners[t].indexOf(s)&&this.listeners[t].push(s)},this.removeEventListener=function(t,s){if(void 0===this.listeners[t])return;const e=[];this.listeners[t].forEach((function(t){t!==s&&e.push(t)})),0===e.length?delete this.listeners[t]:this.listeners[t]=e},this.dispatchEvent=function(t){if(!t)return!0;this.debug&&console.debug(t),t.source=this;const s="on"+t.type;return(!this.hasOwnProperty(s)||(this[s].call(this,t),!t.defaultPrevented))&&(!this.listeners[t.type]||this.listeners[t.type].every((function(s){return s(t),!t.defaultPrevented})))},this._setReadyState=function(t){const s=new CustomEvent("readystatechange");s.readyState=t,this.readyState=t,this.dispatchEvent(s)},this._onStreamFailure=function(t){const s=new CustomEvent("error");s.responseCode=this.xhr.status,s.data=t.currentTarget.response,this.dispatchEvent(s),this.close()},this._onStreamAbort=function(){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(t){if(!this.xhr)return;if(200!==this.xhr.status)return void this._onStreamFailure(t);const s=this.xhr.responseText.substring(this.progress);this.progress+=s.length;const e=(this.chunk+s).split(/(\r\n\r\n|\r\r|\n\n)/g),i=e.pop();e.forEach(function(t){t.trim().length>0&&this.dispatchEvent(this._parseEventChunk(t))}.bind(this)),this.chunk=i},this._onStreamLoaded=function(t){this._onStreamProgress(t),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(t){if(!t||0===t.length)return null;this.debug&&console.debug(t);const s={id:null,retry:null,data:null,event:null};t.split(/\n|\r\n|\r/).forEach(function(t){const e=t.indexOf(this.FIELD_SEPARATOR);let i,n;if(e>0){const s=" "===t[e+1]?2:1;i=t.substring(0,e),n=t.substring(e+s)}else{if(!(e<0))return;i=t,n=""}i in s&&("data"===i&&null!==s[i]?s.data+="\n"+n:s[i]=n)}.bind(this)),null!==s.id&&(this.lastEventId=s.id);const e=new CustomEvent(s.event||"message");return e.id=s.id,e.data=s.data||"",e.lastEventId=this.lastEventId,e},this._onReadyStateChange=function(){if(this.xhr)if(this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){const t={},s=this.xhr.getAllResponseHeaders().trim().split("\r\n");for(const e of s){const[s,...i]=e.split(":"),n=i.join(":").trim();t[s.trim().toLowerCase()]=t[s.trim().toLowerCase()]||[],t[s.trim().toLowerCase()].push(n)}const e=new CustomEvent("open");e.responseCode=this.xhr.status,e.headers=t,this.dispatchEvent(e),this._setReadyState(this.OPEN)}else this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){if(!this.xhr){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._onReadyStateChange.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(let t in this.headers)this.xhr.setRequestHeader(t,this.headers[t]);this.lastEventId.length>0&&this.xhr.setRequestHeader("Last-Event-ID",this.lastEventId),this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))},(void 0===s.start||s.start)&&this.stream()};"undefined"!=typeof exports&&(exports.SSE=SSE);
